# 动态对比敏感度检测系统 - 用户使用说明

## 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [功能详解](#功能详解)
   - [患者管理](#患者管理)
   - [测试配置](#测试配置)
   - [执行测试](#执行测试)
   - [查看结果](#查看结果)
4. [测试模式说明](#测试模式说明)
5. [常见问题](#常见问题)

---

## 系统简介

动态对比敏感度检测系统用于评估患者的视觉对比敏感度功能。系统通过显示不同对比度的光栅图案，让患者判断光栅的运动方向，从而测量患者的对比度阈值。

### 主要功能

- **患者信息管理**：添加、编辑、删除、搜索患者信息
- **测试方案配置**：灵活配置测试参数和模块参数
- **自动/手动测试模式**：支持自动测试和医生手动控制两种模式
- **测试结果管理**：查看历史测试结果，导出 Excel 报告

---

## 快速开始

### 1. 打开系统

在浏览器中访问系统地址（例如：`http://8.130.37.81`），进入主界面。

### 2. 选择或添加患者

在主界面左侧"患者信息"区域：
- **选择已有患者**：点击患者列表中的患者行，选中的患者会高亮显示
- **添加新患者**：填写患者信息（姓名、性别、生日、ID号），点击"新增"按钮

### 3. 配置测试方案（可选）

- 如果使用默认测试方案，可以跳过此步骤
- 如需自定义测试方案，点击"更改选定测试"或"新增测试"按钮

### 4. 选择眼别

在"测试控制"区域选择测试眼别：
- **左眼（L）**：测试左眼
- **右眼（R）**：测试右眼
- **双眼（B）**：测试双眼

### 5. 开始测试

点击"开始测试"按钮，进入测试界面。

---

## 功能详解

### 患者管理

#### 添加患者

1. 在"患者信息"区域填写患者信息：
   - **姓名**：患者姓名
   - **性别**：患者性别
   - **生日**：格式为 YYYY-MM-DD（例如：1990-01-01）
   - **ID号**：患者唯一标识号
2. 点击"新增"按钮
3. 新患者会自动添加到列表中

#### 编辑患者

1. 在患者列表中点击要编辑的患者（选中该患者）
2. 修改表单中的患者信息
3. 点击"保存"按钮保存修改
4. 点击"取消"按钮取消编辑

#### 删除患者

1. 在患者列表中点击要删除的患者（选中该患者）
2. 点击"删除"按钮
3. 确认删除操作

#### 搜索患者

1. 在表单中填写搜索条件（可以只填写部分字段）
2. 点击"搜索"按钮
3. 患者列表会显示匹配的患者

#### 取消选择

- 点击患者列表外的空白区域，可以取消当前选中的患者

---

### 测试配置

点击"更改选定测试"或"新增测试"按钮，进入测试配置界面。

#### 测试信息配置

在"测试信息"标签页中配置基本测试参数：

**基本参数：**
- **测试名称**：测试方案的名称
- **测试距离（cm）**：患者与屏幕的距离（厘米）
- **屏幕长度（cm）**：屏幕的物理长度
- **屏幕宽度（cm）**：屏幕的物理宽度

**光栅参数：**
- **光栅大小（deg）**：光栅的视角大小（度）
- **光栅显示方向**：垂直或水平
- **光栅颜色（灰度 0-255）**：光栅的灰度值，无单位，取值范围 0（黑）～255（白）
- **背景颜色（RGB）**：背景颜色，分别填写 R、G、B 三个数值（0～255）
- **背景亮度（lux）**：背景亮度值
- **平均亮度（lux）**：平均亮度值

**测试设置：**
- **模块间隔时间（s）**：模块之间的间隔时间（秒）
- **模块显示顺序**：
  - **按序**：按配置顺序测试模块
  - **随机**：随机顺序测试模块
- **结果计算（次数）**：用于计算阈值的 reversal 次数
- **是否显示光栅参数**：测试过程中是否显示光栅参数
- **测试方式**：
  - **自动**：系统自动控制测试流程
  - **手动**：医生手动控制光栅方向

配置完成后，点击"保存"按钮保存测试信息。

#### 模块配置

在模块标签页中配置每个测试模块的参数：

**基本参数：**
- **空间频率（c/d）**：光栅的空间频率（周期/度）
- **时间频率（Hz）**：光栅的时间频率（周期/秒）
- **间隔时间（s）**：光栅隐藏的间隔时间（秒）
- **持续时间（s）**：光栅显示的持续时间（秒）
- **初始对比度（%）**：测试开始的对比度值

**切换逻辑：**
- **切换梯度（正确/错误）**：正确和错误时的对比度调整百分比
  - 例如：80%/120% 表示正确时降低到 80%，错误时提高到 120%
- **切换逻辑**：连续正确/错误多少次后切换对比度
  - 例如：1up 1down 表示连续 1 次错误后提高对比度，连续 1 次正确后降低对比度
- **Reversal 目标**：完成多少个 reversal 后结束该模块测试

**模块管理：**
- **添加模块**：点击"模块 +"标签页添加新模块
- **删除模块**：在模块编辑界面点击"删除"按钮（至少保留一个模块）
- **模块命名**：系统自动为模块命名（模块1、模块2...）

配置完成后，点击"提交所有测试信息"按钮保存所有配置。

---

### 执行测试

#### 测试准备阶段

1. 确认测试参数：
   - 测试名称
   - 患者信息
   - 眼别
   - 模块数量
2. 点击"开始测试"按钮

#### 测试指导阶段

1. 阅读测试指导说明
2. 按空格键或点击"开始测试"按钮进入测试

#### 测试执行阶段

**自动模式：**

1. 系统会自动显示光栅
2. 患者观察光栅的运动方向
3. 患者使用方向键响应：
   - **↑**：光栅向上移动
   - **↓**：光栅向下移动
   - **←**：光栅向左移动
   - **→**：光栅向右移动
4. 系统根据患者响应自动调整对比度
5. 完成所有模块后，测试自动结束

**手动模式：**

1. **医生控制光栅方向**（使用 WASD 键）：
   - **W**：设置光栅向上移动
   - **S**：设置光栅向下移动
   - **A**：设置光栅向左移动
   - **D**：设置光栅向右移动
2. 医生按方向键后，光栅开始显示
3. **患者响应**（使用方向键）：
   - **↑**：光栅向上移动
   - **↓**：光栅向下移动
   - **←**：光栅向左移动
   - **→**：光栅向右移动
4. 患者响应后，系统等待医生设置下一个方向
5. 重复步骤 1-4，直到完成所有模块

**测试信息显示：**

- 当前模块编号（例如：模块 1 / 3）
- 当前对比度百分比
- 当前试验编号
- Reversal 进度（例如：Reversal: 2 / 6）
- 如果启用了"显示光栅参数"，还会显示：
  - 空间频率（c/d）
  - 时间频率（Hz）
  - 当前对比度（%）

**测试控制：**

- **ESC 键**：退出测试（如果测试未完成，会提示保存结果）

#### 模块间隔阶段

当一个模块测试完成后，会进入模块间隔阶段：
- 显示"模块 X / Y 已完成，准备下一个模块..."
- 光栅隐藏，但背景和其他信息仍然显示
- 等待设定的模块间隔时间后，自动开始下一个模块

#### 测试结束阶段

测试完成后，显示测试结果：
- 患者信息
- 测试参数
- 各模块的对比度阈值
- 各模块的对比度变化曲线图

**操作选项：**
- **导出结果**：将测试结果导出为 Excel 文件
- **返回主界面**：返回主界面，可以开始新的测试

---

### 查看结果

#### 在主界面查看

在"测试控制"区域的"已完成测试"表格中：
- 显示该患者的所有测试记录
- 包括：序号、时间、模式、眼别
- 点击"导出"按钮可以导出单次测试结果

#### 导出测试结果

1. 在测试结束界面或主界面的"已完成测试"表格中
2. 点击"导出结果"或"导出"按钮
3. 系统会生成 Excel 文件并自动下载
4. Excel 文件包含：
   - 患者信息
   - 测试参数
   - 各模块配置
   - 各模块的详细试验数据
   - 对比度阈值

---

## 测试模式说明

### 自动模式

**特点：**
- 系统自动控制测试流程
- 光栅方向随机生成
- 适合标准化测试

**流程：**
1. 系统自动显示光栅（方向随机）
2. 患者响应
3. 系统自动调整对比度
4. 自动进入下一个试验
5. 完成所有 reversal 后，自动进入下一个模块

### 手动模式

**特点：**
- 医生手动控制光栅方向
- 可以灵活调整测试策略
- 适合特殊测试需求

**流程：**
1. 医生按 WASD 键设置光栅方向
2. 光栅显示
3. 患者响应
4. 系统等待医生设置下一个方向
5. 重复步骤 1-4

**注意事项：**
- 医生必须在患者响应后（或超时后）设置下一个方向
- 如果患者未响应，系统会记录为超时（错误）

---

## 常见问题

### Q1: 如何添加新患者？

A: 在"患者信息"区域填写患者信息，点击"新增"按钮。

### Q2: 如何修改测试方案？

A: 点击"更改选定测试"按钮，进入配置界面修改参数，然后点击"保存"或"提交所有测试信息"。

### Q3: 测试过程中可以暂停吗？

A: 可以按 ESC 键退出测试。如果测试未完成，系统会提示保存结果。

### Q4: 如何导出测试结果？

A: 在测试结束界面点击"导出结果"按钮，或在主界面的"已完成测试"表格中点击"导出"按钮。

### Q5: 手动模式下，医生如何控制光栅方向？

A: 使用 WASD 键：
- W：向上
- S：向下
- A：向左
- D：向右

### Q6: 患者如何响应光栅方向？

A: 使用方向键：
- ↑：向上
- ↓：向下
- ←：向左
- →：向右

### Q7: 测试过程中光栅不显示怎么办？

A: 检查以下设置：
- 测试距离是否正确
- 光栅大小是否合理
- 屏幕尺寸是否正确
- 浏览器是否支持 Canvas

### Q8: 如何删除测试方案？

A: 在主界面点击"删除选定测试"按钮（需要先选中一个测试方案）。

### Q9: 模块顺序如何设置？

A: 在测试配置的"测试信息"标签页中，选择"模块显示顺序"：
- **按序**：按配置顺序测试
- **随机**：随机顺序测试

### Q10: 测试结果保存在哪里？

A: 测试结果保存在数据库中，可以在"已完成测试"表格中查看。导出功能可以将结果保存为 Excel 文件。

---

## 技术支持

如有问题或建议，请联系系统管理员。

---

**版本信息：** v1.0  
**最后更新：** 2025年12月

